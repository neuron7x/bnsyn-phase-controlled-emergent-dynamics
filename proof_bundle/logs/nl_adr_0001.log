     1	# ADR 0001: Math integrator finite/step guardrails
     2	
     3	## Context / problem
     4	The numerical core relied on Euler/RK2/exp-decay helpers without explicit finite-step validation. Invalid `dt`/`tau` or non-finite intermediate values could propagate NaN/Inf into downstream summaries before failing.
     5	
     6	## Decision
     7	Add strict input/output finite checks in `src/bnsyn/numerics/integrators.py`:
     8	- Euler/RK2 require finite positive `dt`.
     9	- Exponential decay requires finite non-negative `dt` and finite positive `tau`.
    10	- All integrators coerce to `float64` and fail fast if output contains non-finite values.
    11	
    12	## Expected numerical effect (stability/error)
    13	No equation changes; this is a fail-closed safety hardening. Semantics are preserved for valid finite inputs while preventing silent NaN/Inf propagation.
    14	
    15	## Tests added/updated
    16	- `tests/test_math_core_hardening.py` (new): finite-smoke checks, dt-halving bounded check, and invalid-input/NaN guard tests for integrators.
    17	- `tests/test_determinism.py` (updated): subprocess reproducibility across different `PYTHONHASHSEED` values.
    18	
    19	## Compatibility impact
    20	No public API/schema/metric-key changes. Behavior only differs for invalid/non-finite numeric inputs, which now raise deterministic `ValueError` earlier.
