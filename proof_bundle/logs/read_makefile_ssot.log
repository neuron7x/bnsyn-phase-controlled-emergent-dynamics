
ssot:
	python -m scripts.validate_bibliography
	python -m scripts.validate_claims
	python -m scripts.scan_normative_tags
	python -m scripts.validate_pr_gates
	python -m scripts.validate_required_status_contexts
	python -m scripts.sync_required_status_contexts --check
	$(MAKE) inventory-check
	python -m scripts.validate_api_maturity
	$(MAKE) api-contract
	$(MAKE) manifest-check
	$(MAKE) traceability-check

validate-claims-coverage:
	python -m scripts.validate_claims_coverage --format markdown

docs-evidence:
	python -m scripts.generate_evidence_coverage

SECURITY_REPORT ?= artifacts/pip-audit.json

security:
	python -m pip install --upgrade pip==26.0.1
	python -m pip install -e ".[dev]"
	mkdir -p artifacts
	python -m scripts.ensure_gitleaks -- detect --redact --verbose --source=.
	python -m pip_audit --desc --format json --output $(SECURITY_REPORT)
	python -m bandit -r src/ -ll

SBOM_REPORT ?= artifacts/prod_ready/reports/sbom.cdx.json

sbom:
	python -m pip install cyclonedx-bom==7.1.0
	mkdir -p $(dir $(SBOM_REPORT))
	cyclonedx-py environment --output-format JSON --output-file $(SBOM_REPORT)

cleanroom:
	$(MAKE) clean
	$(MAKE) install
	$(MAKE) build
	$(MAKE) test
	bnsyn --help

check: format lint mypy coverage ssot security
