$ python -m tools.manifest validate
Manifest validation passed.
$ python -m scripts.validate_trifix_invariants
FAIL: command failed (make test-gate) with exit 2
python -m pytest -m "not (validation or property)" -q
........................................................................ [ 10%]
........................................................................ [ 20%]
........................................................F............... [ 30%]
.........................................ss....ss....................... [ 40%]
........................................................................ [ 51%]
........................................................................ [ 61%]
....................................................................F... [ 71%]
........................................................................ [ 81%]
........................................................................ [ 92%]
........................................................                 [100%]
=================================== FAILURES ===================================
_______________________ test_entropy_gate_no_regressions _______________________

    def test_entropy_gate_no_regressions() -> None:
        repo_root = _repo_root()
        policy = _load_json(repo_root / "entropy" / "policy.json")
        baseline = _load_json(repo_root / "entropy" / "baseline.json")
    
        current = compute_metrics(repo_root)
    
        comparators: dict[str, str] = policy.get("comparators", {})
        assert comparators, "NEEDS_EVIDENCE: policy.json comparators missing/empty"
    
        baseline_flat = flatten(baseline)
        current_flat = flatten(current)
    
        failures: list[str] = []
        for key, comparator in sorted(comparators.items()):
            if key not in baseline_flat:
                failures.append(f"{key}: NEEDS_EVIDENCE baseline missing key")
                continue
            if key not in current_flat:
                failures.append(f"{key}: NEEDS_EVIDENCE current missing key")
                continue
    
            baseline_value = baseline_flat[key]
            current_value = current_flat[key]
    
            if comparator == "lte":
                if not (current_value <= baseline_value):
                    failures.append(
                        f"{key}: regression (current={current_value} > baseline={baseline_value})"
                    )
            elif comparator == "gte":
                if not (current_value >= baseline_value):
                    failures.append(
                        f"{key}: regression (current={current_value} < baseline={baseline_value})"
                    )
            elif comparator == "eq":
                if not (current_value == baseline_value):
                    failures.append(
                        f"{key}: changed (current={current_value} != baseline={baseline_value})"
                    )
            else:
                failures.append(f"{key}: NEEDS_EVIDENCE unknown comparator '{comparator}'")
    
>       assert not failures, "ENTROPY_GATE_BLOCKED:\n" + "\n".join(failures)
E       AssertionError: ENTROPY_GATE_BLOCKED:
E         process.gh_workflows_missing_job_permissions_count: regression (current=40 > baseline=39)
E       assert not ['process.gh_workflows_missing_job_permissions_count: regression (current=40 > baseline=39)']

tests/test_entropy_gate.py:62: AssertionError
_____________ test_phase_atlas_schema_and_regression_baseline_sync _____________

    def test_phase_atlas_schema_and_regression_baseline_sync() -> None:
        schema = _read_json(Path("schemas/phase_atlas.schema.json"))
        atlas = _read_json(Path("artifacts/scientific_product/PHASE_ATLAS.json"))
        baseline = _read_json(Path("artifacts/scientific_product/REGRESSION_BASELINES/phase_atlas_small.json"))
>       jsonschema.validate(instance=atlas, schema=schema)

tests/test_scientific_product_gate.py:69: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

instance = {'atlas_version': '2026.02', 'meta': {'classifier': {'critical_max': 1.05, 'critical_min': 0.95, 'subcritical_max': 0....e': 0.41, 'sigma_estimate': 1.117, 'stability_score': 0.883}, 'regime': 'SUPER', ...}], 'schema_version': '1.0.0', ...}
schema = {'$id': 'https://bnsyn.dev/schemas/phase_atlas.schema.json', '$schema': 'https://json-schema.org/draft/2020-12/schema'...regime', 'sleep', 'temperature'], 'type': 'object'}, 'type': 'array'}, 'schema_version': {'type': 'string'}, ...}, ...}
cls = <class 'jsonschema.validators.Draft202012Validator'>, args = ()
kwargs = {}
validator = Draft202012Validator(schema={'$id': 'https://bnsy...s.schema.json', '$schema': 'https://json...020-12/schema', 'additi...perature'], 'type': 'object'}, 'type': 'array'}, 'schema_version': {'type': 'string'}, ...}, ...}, format_checker=None)
error = <ValidationError: "'45cde59a59fc06eb20e757cfba722bd51f770586bbc3080f5a5118e52469e628' does not match '^[0-9a-f]{40}$'">

    def validate(instance, schema, cls=None, *args, **kwargs):  # noqa: D417
        """
        Validate an instance under the given schema.
    
            >>> validate([2, 3, 4], {"maxItems": 2})
            Traceback (most recent call last):
                ...
            ValidationError: [2, 3, 4] is too long
    
        :func:`~jsonschema.validators.validate` will first verify that the
        provided schema is itself valid, since not doing so can lead to less
        obvious error messages and fail in less obvious or consistent ways.
    
        If you know you have a valid schema already, especially
        if you intend to validate multiple instances with
        the same schema, you likely would prefer using the
        `jsonschema.protocols.Validator.validate` method directly on a
        specific validator (e.g. ``Draft202012Validator.validate``).
    
    
        Arguments:
    
            instance:
    
                The instance to validate
    
            schema:
    
                The schema to validate with
    
            cls (jsonschema.protocols.Validator):
    
                The class that will be used to validate the instance.
    
        If the ``cls`` argument is not provided, two things will happen
        in accordance with the specification. First, if the schema has a
        :kw:`$schema` keyword containing a known meta-schema [#]_ then the
        proper validator will be used. The specification recommends that
        all schemas contain :kw:`$schema` properties for this reason. If no
        :kw:`$schema` property is found, the default validator class is the
        latest released draft.
    
        Any other provided positional and keyword arguments will be passed
        on when instantiating the ``cls``.
    
        Raises:
    
            `jsonschema.exceptions.ValidationError`:
    
                if the instance is invalid
    
            `jsonschema.exceptions.SchemaError`:
    
                if the schema itself is invalid
    
        .. rubric:: Footnotes
        .. [#] known by a validator registered with
            `jsonschema.validators.validates`
    
        """
        if cls is None:
            cls = validator_for(schema)
    
        cls.check_schema(schema)
        validator = cls(schema, *args, **kwargs)
        error = exceptions.best_match(validator.iter_errors(instance))
        if error is not None:
>           raise error
E           jsonschema.exceptions.ValidationError: '45cde59a59fc06eb20e757cfba722bd51f770586bbc3080f5a5118e52469e628' does not match '^[0-9a-f]{40}$'
E           
E           Failed validating 'pattern' in schema['properties']['meta']['properties']['code_sha']:
E               {'type': 'string', 'pattern': '^[0-9a-f]{40}$'}
E           
E           On instance['meta']['code_sha']:
E               '45cde59a59fc06eb20e757cfba722bd51f770586bbc3080f5a5118e52469e628'

/root/.pyenv/versions/3.12.12/lib/python3.12/site-packages/jsonschema/validators.py:1332: ValidationError
=============================== warnings summary ===============================
tests/test_cli_interactive.py::test_cli_module_main_executes
  <frozen runpy>:128: RuntimeWarning: 'bnsyn.cli' found in sys.modules after import of package 'bnsyn', but prior to execution of 'bnsyn.cli'; this may result in unpredictable behaviour

tests/test_coverage_gap_extensions.py::test_viz_interactive_optional_dependency_errors
  <frozen runpy>:128: RuntimeWarning: 'bnsyn.viz.interactive' found in sys.modules after import of package 'bnsyn.viz', but prior to execution of 'bnsyn.viz.interactive'; this may result in unpredictable behaviour

tests/test_manifest_builder.py::test_build_experiment_manifest_filters_manifest_json
  /workspace/bnsyn-phase-controlled-emergent-dynamics/src/bnsyn/provenance/manifest_builder.py:145: UserWarning: Failed to capture git SHA: Command '['/usr/bin/git', 'rev-parse', 'HEAD']' returned non-zero exit status 128.
    "git_commit": _get_git_commit(resolved_root, resolved_version),

tests/test_manifest_builder.py::test_build_experiment_manifest_filters_manifest_json
  /workspace/bnsyn-phase-controlled-emergent-dynamics/src/bnsyn/provenance/manifest_builder.py:145: UserWarning: Using fallback git identifier: release-0.2.0
    "git_commit": _get_git_commit(resolved_root, resolved_version),

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
FAILED tests/test_entropy_gate.py::test_entropy_gate_no_regressions - Asserti...
FAILED tests/test_scientific_product_gate.py::test_phase_atlas_schema_and_regression_baseline_sync

make: *** [Makefile:58: test-gate] Error 1

$ PYTHONPATH=src python -m pytest tests/test_scientific_product_gate.py -q
....F                                                                    [100%]
=================================== FAILURES ===================================
_____________ test_phase_atlas_schema_and_regression_baseline_sync _____________

    def test_phase_atlas_schema_and_regression_baseline_sync() -> None:
        schema = _read_json(Path("schemas/phase_atlas.schema.json"))
        atlas = _read_json(Path("artifacts/scientific_product/PHASE_ATLAS.json"))
        baseline = _read_json(Path("artifacts/scientific_product/REGRESSION_BASELINES/phase_atlas_small.json"))
>       jsonschema.validate(instance=atlas, schema=schema)

tests/test_scientific_product_gate.py:69: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

instance = {'atlas_version': '2026.02', 'meta': {'classifier': {'critical_max': 1.05, 'critical_min': 0.95, 'subcritical_max': 0....e': 0.41, 'sigma_estimate': 1.117, 'stability_score': 0.883}, 'regime': 'SUPER', ...}], 'schema_version': '1.0.0', ...}
schema = {'$id': 'https://bnsyn.dev/schemas/phase_atlas.schema.json', '$schema': 'https://json-schema.org/draft/2020-12/schema'...regime', 'sleep', 'temperature'], 'type': 'object'}, 'type': 'array'}, 'schema_version': {'type': 'string'}, ...}, ...}
cls = <class 'jsonschema.validators.Draft202012Validator'>, args = ()
kwargs = {}
validator = Draft202012Validator(schema={'$id': 'https://bnsy...s.schema.json', '$schema': 'https://json...020-12/schema', 'additi...perature'], 'type': 'object'}, 'type': 'array'}, 'schema_version': {'type': 'string'}, ...}, ...}, format_checker=None)
error = <ValidationError: "'45cde59a59fc06eb20e757cfba722bd51f770586bbc3080f5a5118e52469e628' does not match '^[0-9a-f]{40}$'">

    def validate(instance, schema, cls=None, *args, **kwargs):  # noqa: D417
        """
        Validate an instance under the given schema.
    
            >>> validate([2, 3, 4], {"maxItems": 2})
            Traceback (most recent call last):
                ...
            ValidationError: [2, 3, 4] is too long
    
        :func:`~jsonschema.validators.validate` will first verify that the
        provided schema is itself valid, since not doing so can lead to less
        obvious error messages and fail in less obvious or consistent ways.
    
        If you know you have a valid schema already, especially
        if you intend to validate multiple instances with
        the same schema, you likely would prefer using the
        `jsonschema.protocols.Validator.validate` method directly on a
        specific validator (e.g. ``Draft202012Validator.validate``).
    
    
        Arguments:
    
            instance:
    
                The instance to validate
    
            schema:
    
                The schema to validate with
    
            cls (jsonschema.protocols.Validator):
    
                The class that will be used to validate the instance.
    
        If the ``cls`` argument is not provided, two things will happen
        in accordance with the specification. First, if the schema has a
        :kw:`$schema` keyword containing a known meta-schema [#]_ then the
        proper validator will be used. The specification recommends that
        all schemas contain :kw:`$schema` properties for this reason. If no
        :kw:`$schema` property is found, the default validator class is the
        latest released draft.
    
        Any other provided positional and keyword arguments will be passed
        on when instantiating the ``cls``.
    
        Raises:
    
            `jsonschema.exceptions.ValidationError`:
    
                if the instance is invalid
    
            `jsonschema.exceptions.SchemaError`:
    
                if the schema itself is invalid
    
        .. rubric:: Footnotes
        .. [#] known by a validator registered with
            `jsonschema.validators.validates`
    
        """
        if cls is None:
            cls = validator_for(schema)
    
        cls.check_schema(schema)
        validator = cls(schema, *args, **kwargs)
        error = exceptions.best_match(validator.iter_errors(instance))
        if error is not None:
>           raise error
E           jsonschema.exceptions.ValidationError: '45cde59a59fc06eb20e757cfba722bd51f770586bbc3080f5a5118e52469e628' does not match '^[0-9a-f]{40}$'
E           
E           Failed validating 'pattern' in schema['properties']['meta']['properties']['code_sha']:
E               {'type': 'string', 'pattern': '^[0-9a-f]{40}$'}
E           
E           On instance['meta']['code_sha']:
E               '45cde59a59fc06eb20e757cfba722bd51f770586bbc3080f5a5118e52469e628'

/root/.pyenv/versions/3.12.12/lib/python3.12/site-packages/jsonschema/validators.py:1332: ValidationError
=========================== short test summary info ============================
FAILED tests/test_scientific_product_gate.py::test_phase_atlas_schema_and_regression_baseline_sync
$ python -m scripts.validate_branch_protection_governance
OK: branch protection governance document validated
$ python -m scripts.validate_workflow_contracts
Workflow contracts validation passed.
