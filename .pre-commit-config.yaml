repos:
  - repo: https://github.com/astral-sh/ruff-pre-commit
    rev: v0.14.11
    hooks:
      - id: ruff
      - id: ruff-format
  - repo: https://github.com/pre-commit/mirrors-mypy
    rev: v1.19.1
    hooks:
      - id: mypy
  - repo: local
    hooks:
      - id: pip-audit
        name: pip-audit
        entry: pip-audit --desc
        language: python
        pass_filenames: false
        additional_dependencies:
          - pip-audit
      - id: no-requirements-txt
        name: Prevent requirements.txt
        entry: bash -c 'if git diff --cached --name-only | grep -q "^requirements\\.txt$"; then echo "ERROR: requirements.txt detected. Use pyproject.toml."; exit 1; fi'
        language: system
        pass_filenames: false
      - id: validate-pyproject
        name: Validate pyproject.toml
        entry: validate-pyproject
        language: python
        files: ^pyproject\.toml$
        additional_dependencies:
          - validate-pyproject
      - id: pytest-smoke
        name: pytest smoke tests
        entry: pytest -m "not validation" -v --tb=short
        language: system
        stages: [push]
        pass_filenames: false
      - id: coverage-check
        name: coverage must be >= 85%
        entry: pytest --cov=src/bnsyn --cov-fail-under=85 -q
        language: system
        stages: [push]
        pass_filenames: false
      - id: ssot-gates
        name: SSOT gates
        entry: bash -c 'python scripts/validate_bibliography.py && python scripts/validate_claims.py && python scripts/scan_normative_tags.py'
        language: system
        stages: [push]
        pass_filenames: false
