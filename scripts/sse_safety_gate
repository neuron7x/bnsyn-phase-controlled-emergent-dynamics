#!/usr/bin/env python3
from __future__ import annotations

import re
from pathlib import Path

ROOT = Path(__file__).resolve().parents[1]


def main() -> int:
    bad = []
    pat = re.compile(r"(AWS_SECRET|BEGIN PRIVATE KEY|api[_-]?key\s*=)", re.IGNORECASE)
    for path in ROOT.rglob("*"):
        if not path.is_file() or ".git" in path.parts:
            continue
        if path.suffix in {".png", ".jpg", ".jpeg", ".gif", ".pdf", ".svg", ".whl", ".zip"}:
            continue
        try:
            text = path.read_text(encoding="utf-8")
        except Exception:
            continue
        if pat.search(text) and "[REDACTED]" not in text:
            bad.append(str(path.relative_to(ROOT)))
    print("OK" if not bad else "\n".join(bad))
    return 0 if not bad else 1


if __name__ == "__main__":
    raise SystemExit(main())
