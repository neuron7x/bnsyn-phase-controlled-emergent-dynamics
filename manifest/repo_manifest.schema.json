{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://example.local/repo_manifest.schema.json",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "manifest_version",
    "required_pr_gates",
    "invariants",
    "metrics",
    "policies",
    "evidence_rules"
  ],
  "properties": {
    "manifest_version": {
      "type": "string",
      "pattern": "^[0-9]+\\.[0-9]+$"
    },
    "required_pr_gates": {
      "type": "object",
      "additionalProperties": false,
      "required": ["source", "sha256"],
      "properties": {
        "source": {"type": "string", "minLength": 1},
        "sha256": {"type": "string", "pattern": "^[a-f0-9]{64}$"}
      }
    },
    "invariants": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": ["id", "statement", "enforcement", "evidence_kind"],
        "properties": {
          "id": {"type": "string", "pattern": "^INV-[0-9]{3}$"},
          "statement": {"type": "string", "minLength": 1},
          "enforcement": {"type": "string", "minLength": 1},
          "evidence_kind": {"type": "string", "enum": ["path:line-span", "artifact"]}
        }
      }
    },
    "metrics": {
      "type": "array",
      "items": {"type": "string", "minLength": 1},
      "uniqueItems": true
    },
    "policies": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "generated_files_are_readonly",
        "drift_is_failure",
        "deterministic_sorting",
        "generated_files"
      ],
      "properties": {
        "generated_files_are_readonly": {"type": "boolean"},
        "drift_is_failure": {"type": "boolean"},
        "deterministic_sorting": {"type": "boolean"},
        "generated_files": {
          "type": "array",
          "minItems": 1,
          "items": {"type": "string", "minLength": 1}
        }
      }
    },
    "evidence_rules": {
      "type": "object",
      "additionalProperties": false,
      "required": ["accepted_pointer_formats"],
      "properties": {
        "accepted_pointer_formats": {
          "type": "array",
          "minItems": 1,
          "items": {"type": "string", "minLength": 1}
        }
      }
    }
  }
}
