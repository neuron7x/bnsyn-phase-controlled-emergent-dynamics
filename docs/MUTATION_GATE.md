# Mutation Gate Contract

## Canonical Source of Truth

Execution standard for tooling commands: `python -m scripts.<module>`.


All mutation metrics are defined and derived in:

- `scripts/mutation_counts.py`

No other non-test module may implement mutation score math.

## Metric Contract

### Count source

Counts are read via `mutmut result-ids` statuses in `read_mutation_counts()`:

- `killed`
- `survived`
- `timeout`
- `suspicious`
- `skipped`
- `untested`

### Denominator

`total_scored = killed + survived + timeout + suspicious`

### Numerator

`killed_equivalent = killed + timeout`

### Score

`score_percent = round(100 * killed_equivalent / total_scored, 2)` with `0.0` when denominator is zero.

## Baseline Contract

Baseline file path:

- `quality/mutation_baseline.json`

Validation command:

- `python -m scripts.validate_mutation_baseline`

Required top-level keys:

- `version`
- `timestamp`
- `baseline_score`
- `tolerance_delta`
- `status`
- `description`
- `config`
- `scope`
- `metrics`

Allowed status values:

- `active`
- `needs_regeneration`

Required `metrics` keys:

- `total_mutants`
- `killed_mutants`
- `survived_mutants`
- `timeout_mutants`
- `suspicious_mutants`
- `score_percent`

## CI Output Contract

Generated by `render_github_output_lines()` in stable order:

1. `baseline_score`
2. `tolerance`
3. `min_acceptable`
4. `score`
5. `total`
6. `killed`

Formatting rules:

- floats use fixed 2 decimal places
- newline at end of output payload
- no extra keys

## Summary vs Gate Semantics

`python -m scripts.mutation_ci_summary --write-output --write-summary` is best-effort for summary emission.
When baseline is invalid/unavailable or mutation counts are unavailable, it writes a `NOT EVALUATED` summary block and does not enforce the gate.

Enforcement is exclusively:

- `python -m scripts.check_mutation_score --strict`

## Strict vs Advisory Gate

`python -m scripts.check_mutation_score --strict`

- Fails when baseline is uninitialized or invalid for strict mode.
- Fails when current score is below baseline threshold (`baseline_score - tolerance_delta`).

`python -m scripts.check_mutation_score --advisory`

- Warns and exits zero when baseline is uninitialized.
- Still reports threshold evaluation when baseline is active.

## Local Repro Commands

Run mutation execution profile:

- `make mutation`

Emit CI-style outputs/summary locally:

- `make mutation-ci`

Full strict check against baseline:

- `make mutation-check-strict`

## Mutation Artifacts

`python -m scripts.run_mutation_pipeline` emits:

- `mutation_results.txt`
- `mutation_results.stderr.txt`
- `survived_mutants.txt`
